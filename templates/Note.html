<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ó–∞–º–µ—Ç–∫–∏ | IoT</title>
  <meta name="csrf-token" content="{{ csrf_token() }}">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    * {
      box-sizing: border-box;
    }
    /* –û—Å–Ω–æ–≤–Ω–∞—è —Å–µ—Ç–∫–∞ */
    .container {
      display: grid;
      grid-template-columns: 1fr 2fr; /* –ª–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ —É–∂–µ, –ø—Ä–∞–≤–∞—è —à–∏—Ä–µ */
      gap: 20px;
      max-width: 1200px; /* —á—Ç–æ–±—ã –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–µ —Ä–∞—Å—Ç—è–≥–∏–≤–∞–ª—Å—è –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω */
      margin: 0 auto; /* —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º */
      padding: 20px;
    }

    .card {
      background-color: #1e1e1e;
      padding: 20px;
      border-radius: 4px;
      color: #fff;
      box-sizing: border-box;
      position: relative; /* <<< –¥–æ–±–∞–≤—å –≤–æ—Ç —ç—Ç–æ */
    }

    h3 {
      margin-top: 0;
      z-index: 2;
    }

    /* –°–ø–∏—Å–æ–∫ –∑–∞–º–µ—Ç–æ–∫ */
    ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    ul li {
      padding: 5px;
      cursor: pointer;
      border-bottom: 1px solid #333;
    }
    ul li:hover {
      background-color: #323232;
    }

    /* –ü–æ–ª–µ –≤–≤–æ–¥–∞ –¥–ª—è –∑–∞–º–µ—Ç–∫–∏ */
    textarea {
      width: 100%;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #444;
      resize: vertical;
      font-size: 1rem;
      background-color: #181818;
      color: #ffffff;
      box-shadow: 0 0 0 rgba(0,0,0,0);
      transition: box-shadow 0.3s ease, border-color 0.2s ease;
      margin: 0; /* —É–±–∏—Ä–∞–µ–º –≤–Ω–µ–∑–∞–ø–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã */
      display: block; /* –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –≤ —Å–µ—Ç–∫–µ */
    }

    textarea:focus {
      outline: none;
      border-color: #2979ff;
    }

    .btn-group {
      margin-top: 10px;
    }
    

    /* –ë–ª–æ–∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∑–∞–º–µ—Ç–∫–µ */
    #noteInfo {
      background-color: #2e2e2e;
      margin-top: 10px;
      padding: 10px;
      border-radius: 4px;
      font-size: 0.9rem;
    }
    #noteInfo ul {
      margin: 0;
      padding: 0;
      list-style: none;
    }
    #noteInfo li {
      margin-bottom: 5px;
    }

    #connectionStatus {
      display: none;
      position: fixed;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      background-color: #b00020;
      color: white;
      padding: 10px 20px;
      border-bottom-left-radius: 10px;
      border-bottom-right-radius: 10px;
      z-index: 1000;
      font-weight: bold;
      box-shadow: 0 2px 10px rgba(0,0,0,0.5);
      opacity: 0;
      transition: opacity 0.5s ease;
    }

    #connectionStatus.show {
      opacity: 1;
      display: block;
    }

    /* –ú–∏–≥–∞–Ω–∏–µ —Ç–µ–Ω–∏ */
    .card.blink,
    #noteContent.blink {
      animation: blink-shadow 1.5s infinite ease-in-out;
    }

    .server-down {
      color: #ff3d3d !important;
      transition: color 0.3s ease;
    }

    @keyframes blink-shadow {
      0%, 100% {
        box-shadow: 0px 4px 12px rgba(255, 0, 0, 0.4);
      }
      50% {
        box-shadow: 0px 4px 12px rgba(255, 0, 0, 0.9);
      }
    }



    .btn_up {
      position: absolute;
      left: 50%;
      top: -10px;
      transform: translateX(-50%);
      width: 170px;
      background-color: #262626;
      color: #fff;
      border: none;
      border-bottom-left-radius: 4px;
      border-bottom-right-radius: 4px;
      border-top-left-radius: 0px;
      border-top-right-radius: 0px;
      padding: 8px 14px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      margin-bottom: 15px;
      box-shadow: 0px 3px 6px rgba(0, 0, 0, 0.16), 0px 3px 6px rgba(0, 0, 0, 0.23);
      z-index: 1;
    }
    .btn_up:hover {
      background-color: #393939;
    }

    .btn-hide {
      display: none;
    }

    /* –ù–∏–∂–Ω–∏–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫ */
    .text_down {
      background-color: #003d4240;
      color: #ffffff45;
      text-align: center;
      position: fixed;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 16%;
      padding: 10px;
      border-top-left-radius: 12px;
      border-top-right-radius: 12px;
      margin-bottom: 10px;
    }
    @media screen and (max-width: 768px) {
      .text_down {
        width: 90%;
        font-size: 14px;
        padding: 8px;
      }
    }
  </style>

  <link rel="stylesheet" href="{{ url_for('static', filename='Index_Standart.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='vk_keyboard.css') }}">
</head>
<body>
  <div id="connectionStatus">üö´ –ü–æ—Ç–µ—Ä—è–Ω–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º</div>
  <div class="container">
    
    <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: —Å–ø–∏—Å–æ–∫ –∑–∞–º–µ—Ç–æ–∫ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π -->
    <div class="card" id="notesListCard">
      <button onclick="goBack()" class="btn_up">–ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</button>
      <h3>–ó–∞–º–µ—Ç–∫–∏</h3>
      <ul id="notesList"></ul>
      <input type="text" id="newNoteName" placeholder="–ò–º—è –Ω–æ–≤–æ–π –∑–∞–º–µ—Ç–∫–∏">
      <button id="createNoteBtn">–°–æ–∑–¥–∞—Ç—å –∑–∞–º–µ—Ç–∫—É</button>
    </div>

    <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –¥–µ—Ç–∞–ª–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∑–∞–º–µ—Ç–∫–∏ -->
    <div class="card" id="noteDetailCard">
      <h3 id="currentNoteTitle">–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–º–µ—Ç–∫—É</h3>
      <textarea id="noteContent" rows="10" placeholder="–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∑–∞–º–µ—Ç–∫–∏..."></textarea>
      <div id="noteInfo"></div>
      <div class="btn-group">
        <button id="saveNoteBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button id="deleteNoteBtn">–£–¥–∞–ª–∏—Ç—å –∑–∞–º–µ—Ç–∫—É</button>
        <button id="copyNoteBtn">–°–¥–µ–ª–∞—Ç—å –∫–æ–ø–∏—é</button>
      </div>
    </div>
  </div>

  <!-- –ù–∏–∂–Ω–∏–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫ -->
  <div class="text_down">
    IoT-Light System v1.0.0 (Release)<br>
    <a id="theme-name">Standart v1 | By FireTIA</a>
  </div>
  
  <script src="{{ url_for('static', filename='vk_keyboard.js') }}"></script>
  <script>
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è CSRF-—Ç–æ–∫–µ–Ω–∞ –≤ –∑–∞–ø—Ä–æ—Å
    function csrfFetch(url, options = {}) {
      options.headers = options.headers || {};
      const token = document.querySelector('meta[name="csrf-token"]')?.getAttribute('content');
      if (token) {
        options.headers['X-CSRFToken'] = token;
      }
      return fetch(url, options);
    }

    function goBack() {
      window.location.href = "/Menu.html"; // –∏–ª–∏ –∫—É–¥–∞ —Ç–µ–±–µ –Ω—É–∂–Ω–æ
    }
  


    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
    function formatMeta(meta) {
      /*
         –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä–æ–∫ –≤ meta:
         1| Date_creation - 28.03.2025
         2| Time_creation - 17:54:51
         ...
         7| --- Note start ---
      */
      const lines = meta.split('\n').filter(line => line.trim() !== '');
      let html = '<ul>';
      for (const line of lines) {
        // –ï—Å–ª–∏ –≤—Å—Ç—Ä–µ—Ç–∏–ª–∏ –º–∞—Ä–∫–µ—Ä –Ω–∞—á–∞–ª–∞ –∑–∞–º–µ—Ç–∫–∏ ‚Äî –¥–∞–ª—å—à–µ –∏–¥—É—Ç —Å–æ–¥–µ—Ä–∂–∏–º—ã–µ —Å—Ç—Ä–æ–∫–∏
        if (line.includes('--- Note start ---')) {
          break;
        }
        // –ü–∞—Ä—Å–∏–º —Å—Ç—Ä–æ–∫—É –≤–∏–¥–∞ "1| Date_creation - 28.03.2025"
        const splitted = line.split('|');
        if (splitted.length < 2) {
          continue; // –µ—Å–ª–∏ —Ñ–æ—Ä–º–∞—Ç –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
        }
        const contentPart = splitted[1].trim(); // "Date_creation - 28.03.2025"
        // –¢–µ–ø–µ—Ä—å –¥–µ–ª–∏–º –ø–æ " - "
        const splitted2 = contentPart.split(' - ');
        if (splitted2.length === 2) {
          const key = splitted2[0].trim();
          const value = splitted2[1].trim();
          // –í—ã–≤–æ–¥–∏–º –∫–∞–∫ "Date_creation: 28.03.2025"
          html += `<li><strong>${key}:</strong> ${value}</li>`;
        } else {
          // fallback ‚Äî –≤—ã–≤–æ–¥–∏–º –∫–∞–∫ –µ—Å—Ç—å
          html += `<li>${contentPart}</li>`;
        }
      }
      html += '</ul>';
      return html;
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –∑–∞–º–µ—Ç–æ–∫
    function loadNotesList() {
      csrfFetch('/notes/list')
        .then(response => response.json())
        .then(data => {
          if (data.status === 'success') {
            const notesList = document.getElementById('notesList');
            notesList.innerHTML = '';
            data.notes.forEach(note => {
              const li = document.createElement('li');
              li.textContent = note;
              li.onclick = () => loadNote(note);
              notesList.appendChild(li);
            });
          } else {
            alert(data.message);
          }
        })
        .catch(err => console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ –∑–∞–º–µ—Ç–æ–∫:', err));
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∑–∞–º–µ—Ç–∫–∏
    function loadNote(noteName) {
      csrfFetch(`/notes/info?name=${encodeURIComponent(noteName)}`)
        .then(response => response.json())
        .then(data => {
          if (data.status === 'success') {
            document.getElementById('currentNoteTitle').textContent = noteName;
            const contentArea = document.getElementById('noteContent');
            const noteInfo = document.getElementById('noteInfo');

            // –†–∞–∑–¥–µ–ª—è–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –ø–æ –º–∞—Ä–∫–µ—Ä—É "7| --- Note start ---"
            const parts = data.content.split('7| --- Note start ---');
            if (parts.length > 1) {
              // meta = –≤—Å—ë –¥–æ –º–∞—Ä–∫–µ—Ä–∞
              const meta = parts[0];
              // noteParts[0] = —Ä–µ–∞–ª—å–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∑–∞–º–µ—Ç–∫–∏
              const noteParts = parts[1].split('9| --- Note end ---');
              contentArea.value = noteParts[0].trim();

              // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º meta –∏ –≤—ã–≤–æ–¥–∏–º
              noteInfo.innerHTML = formatMeta(meta);
            } else {
              // –ï—Å–ª–∏ —Ñ–æ—Ä–º–∞—Ç –¥—Ä—É–≥–æ–π, –ø—Ä–æ—Å—Ç–æ –∑–∞–ø–æ–ª–Ω—è–µ–º
              contentArea.value = data.content;
              noteInfo.innerHTML = '';
            }
          } else {
            alert(data.message);
          }
        })
        .catch(err => console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–º–µ—Ç–∫–∏:', err));
    }

    // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–º–µ—Ç–∫–∏
    document.getElementById('createNoteBtn').addEventListener('click', () => {
      const noteName = document.getElementById('newNoteName').value.trim();
      if (!noteName) {
        alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∑–∞–º–µ—Ç–∫–∏');
        return;
      }
      csrfFetch('/notes/create', {
        method: 'POST',
        body: JSON.stringify({ name: noteName }),
        headers: { 'Content-Type': 'application/json' }
      })
      .then(response => response.json())
      .then(data => {
        alert(data.message);
        if (data.status === 'success') {
          loadNotesList();
          document.getElementById('newNoteName').value = '';
        }
      })
      .catch(err => console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–º–µ—Ç–∫–∏:', err));
    });

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∑–∞–º–µ—Ç–∫–µ
    document.getElementById('saveNoteBtn').addEventListener('click', () => {
      const noteName = document.getElementById('currentNoteTitle').textContent;
      const content = document.getElementById('noteContent').value;
      if (noteName === '–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–º–µ—Ç–∫—É') {
        alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∑–∞–º–µ—Ç–∫—É');
        return;
      }
      csrfFetch('/notes/save', {
        method: 'POST',
        body: JSON.stringify({ name: noteName, content: content }),
        headers: { 'Content-Type': 'application/json' }
      })
      .then(response => response.json())
      .then(data => {
        alert(data.message);
        if (data.status === 'success') {
          loadNotesList();
        }
      })
      .catch(err => console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–º–µ—Ç–∫–∏:', err));
    });

    // –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏
    document.getElementById('deleteNoteBtn').addEventListener('click', () => {
      const noteName = document.getElementById('currentNoteTitle').textContent;
      if (noteName === '–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–º–µ—Ç–∫—É') {
        alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∑–∞–º–µ—Ç–∫—É');
        return;
      }
      if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∑–∞–º–µ—Ç–∫—É?')) return;
      csrfFetch('/notes/delete', {
        method: 'POST',
        body: JSON.stringify({ name: noteName }),
        headers: { 'Content-Type': 'application/json' }
      })
      .then(response => response.json())
      .then(data => {
        alert(data.message);
        if (data.status === 'success') {
          document.getElementById('currentNoteTitle').textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–º–µ—Ç–∫—É';
          document.getElementById('noteContent').value = '';
          document.getElementById('noteInfo').innerHTML = '';
          loadNotesList();
        }
      })
      .catch(err => console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–º–µ—Ç–∫–∏:', err));
    });

    // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏
    document.getElementById('copyNoteBtn').addEventListener('click', () => {
      const noteName = document.getElementById('currentNoteTitle').textContent;
      if (noteName === '–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–º–µ—Ç–∫—É') {
        alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∑–∞–º–µ—Ç–∫—É');
        return;
      }
      const newName = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∏–º—è –¥–ª—è –∫–æ–ø–∏–∏ –∑–∞–º–µ—Ç–∫–∏:');
      if (!newName) return;
      csrfFetch('/notes/copy', {
        method: 'POST',
        body: JSON.stringify({ name: noteName, new_name: newName }),
        headers: { 'Content-Type': 'application/json' }
      })
      .then(response => response.json())
      .then(data => {
        alert(data.message);
        if (data.status === 'success') {
          loadNotesList();
        }
      })
      .catch(err => console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–º–µ—Ç–∫–∏:', err));
    });

    let lastConnectionStatus = true;

    setInterval(() => {
      csrfFetch('/notes/list')
        .then(response => {
          if (!response.ok) throw new Error('–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É');

          // –¢–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –æ—Ç offline –∫ online
          if (!lastConnectionStatus) {
            const btn_up_stat = document.getElementById('btn_up');
            const status = document.getElementById('connectionStatus');
            const h3 = document.querySelector('#notesListCard h3');

            status.textContent = '‚úÖ –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ';
            status.style.backgroundColor = '#1db954'; // –∑–µ–ª—ë–Ω–∞—è –ø–ª–∞—à–∫–∞
            status.classList.add('show');

            // –û—Ç–∫–ª—é—á–∞–µ–º –º–∏–≥–∞–Ω–∏–µ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–µ–Ω–∏
            document.querySelectorAll('.card').forEach(card => card.classList.remove('blink'));
            document.querySelector('#noteContent').classList.remove('blink');
            updateDeviceColorShadow();

            h3.textContent = '–ó–∞–º–µ—Ç–∫–∏';
            h3.classList.remove('server-down');
            

            document.getElementById('sound-up').play();

            setTimeout(() => {
              status.classList.remove('show');
            }, 8000); // —É–±–∏—Ä–∞–µ–º –ø–ª–∞—à–∫—É —á–µ—Ä–µ–∑ 8 —Å–µ–∫—É–Ω–¥—ã
          }

          lastConnectionStatus = true;
        })
        .catch(err => {
          console.warn('–ù–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º:', err.message);
          const status = document.getElementById('connectionStatus');
          const btn_up_stat = document.getElementById('btn_up');
          const h3 = document.querySelector('#notesListCard h3');

          if (lastConnectionStatus) {
            // —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –¥–∏—Å–∫–æ–Ω–Ω–µ–∫—Ç–µ
            status.textContent = 'üö´ –ü–æ—Ç–µ—Ä—è–Ω–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º';
            status.style.backgroundColor = '#b00020'; // –∫—Ä–∞—Å–Ω–∞—è –ø–ª–∞—à–∫–∞
            status.classList.add('show');

            document.getElementById('sound-down').play();
          }

          h3.textContent = '–ó–∞–º–µ—Ç–∫–∏ (–ü–û–¢–ï–†–Ø–ù–û –°–û–ï–î–ò–ù–ï–ù–ò–ï –° –°–ï–†–í–ï–†–û–ú)';
          h3.classList.add('server-down');



          document.querySelectorAll('.card').forEach(card => card.classList.add('blink'));
          document.querySelector('#noteContent').classList.add('blink');

          lastConnectionStatus = false;
        });
    }, 5000);

        window.addEventListener('DOMContentLoaded', () => {
      const baseURL = `${location.protocol}//${location.hostname}${location.port ? `:${location.port}` : ''}`;
      
      const soundUp = document.getElementById('sound-up');
      const soundDown = document.getElementById('sound-down');

      if (soundUp && soundDown) {
        soundUp.src = `${baseURL}/sound/beginning.mp3`;
        soundDown.src = `${baseURL}/sound/pipes.mp3`;
      } else {
        console.warn('‚ö†Ô∏è –≠–ª–µ–º–µ–Ω—Ç—ã –∞—É–¥–∏–æ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ DOM');
      }
    });


    // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å–Ω–∞—á–∞–ª–∞ –ø–æ–¥–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –∑–∞–º–µ—Ç–æ–∫
    window.addEventListener('load', () => {
      loadNotesList();
      updateDeviceColorShadow(); // –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Ç–µ–Ω—å (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
    });

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ç–µ–Ω–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ü–≤–µ—Ç–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (–ø—Ä–∏–º–µ—Ä)
    function updateDeviceColorShadow() {
      csrfFetch('/get_device_info')
        .then(response => response.json())
        .then(data => {
          if (data && data.length > 0) {
            const adjustedColor = data[0].color;
            document.querySelectorAll('.card').forEach(card => {
              card.style.boxShadow = `0px 4px 10px rgba(${adjustedColor.r}, ${adjustedColor.g}, ${adjustedColor.b}, 0.7)`;
            });
            document.querySelector('#noteContent').style.boxShadow = `0px 4px 12px rgba(${adjustedColor.r}, ${adjustedColor.g}, ${adjustedColor.b}, 0.6)`;
            document.querySelectorAll('.btn_up').forEach(btn_up => {
              btn_up.style.boxShadow = `0px 2px 10px rgba(${adjustedColor.r}, ${adjustedColor.g}, ${adjustedColor.b}, 0.3)`;
            });
          }
        })
        .catch(error => {
          console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ:', error);
        });
    }
  </script>
<audio id="sound-up" preload="auto"></audio>
<audio id="sound-down" preload="auto"></audio>
</body>
</html>

<!DOCTYPE html>
<html lang="ru">
<head>
  <meta name="csrf-token" content="{{ csrf_token() }}">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IoT-LS - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π</title>
  <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —à—Ä–∏—Ñ—Ç–æ–≤ -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500">
  <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ CSS —Ñ–∞–π–ª–∞ —Ç–µ–º—ã -->
  <link id="theme-style" rel="stylesheet" href="{{ url_for('static', filename='Index_Standart.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='vk_keyboard.css') }}">
  <style>
    /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
    body {
      background-color: #121212;
      color: #ffffff;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –∏–∫–æ–Ω–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã */
    .theme-toggle {
      position: fixed;
      bottom: 15px;
      left: 15px;
      width: 40px;
      height: 40px;
      background: url("{{ url_for('static', filename='light-mode-icon.png') }}") no-repeat center;
      background-size: cover;
      cursor: pointer;
      transition: transform 0.2s ease-in-out;
      text-shadow: 0 0 10px #00daae, 0 0 20px #00c9a1, 0 0 30px #005645;
    }

    .theme-toggle:hover {
      transform: scale(1.1);
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –Ω–∏–∂–Ω–µ–≥–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –±–ª–æ–∫–∞ */
    .text_down {
      background-color: #003d4240;
      position: relative;
      bottom: 0px; /* –æ—Ç—Å—Ç—É–ø –æ—Ç –Ω–∏–∂–Ω–µ–≥–æ –∫—Ä–∞—è */
      left: 50%;
      transform: translateX(-50%); /* —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ—Ç —ç–ª–µ–º–µ–Ω—Ç –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ */
      color: #ffffff45;
      text-align: center;
      width: 16%; /* —á—Ç–æ–±—ã —Ç–µ–∫—Å—Ç –≤—Å–µ–≥–¥–∞ –±—ã–ª –≤ —Ü–µ–Ω—Ç—Ä–µ */
      border-top-left-radius: 12px;
      border-bottom-left-radius: 1px;
      border-top-right-radius: 12px;
      border-bottom-right-radius: 1px;
    }
    @media screen and (max-width: 768px) {
      .text_down {
        width: 90%; /* –ó–∞–Ω–∏–º–∞–µ—Ç 90% —à–∏—Ä–∏–Ω—ã —ç–∫—Ä–∞–Ω–∞ */
        font-size: 14px; /* –£–º–µ–Ω—å—à–∞–µ–º —à—Ä–∏—Ñ—Ç */
        padding: 8px; /* –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç—Å—Ç—É–ø—ã */
      }
    }

    .btn_up {
      position: absolute;
      left: 45%;
      top: 78px;
      width: 170px;
      background-color: #262626;
      color: #fff;
      border: none;
      border-bottom-left-radius: 4px;
      border-bottom-right-radius: 4px;
      border-top-left-radius: 0px;
      border-top-right-radius: 0px;
      padding: 8px 14px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      margin-bottom: 15px;
      box-shadow: 0px 3px 6px rgba(0, 0, 0, 0.16), 0px 3px 6px rgba(0, 0, 0, 0.23);
    }
    .btn_up:hover {
      background-color: #393939;
    }

  </style>
</head>
<body>
  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
  <div class="container">
    <h1>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π</h1>
    
    <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –≤—ã–±–æ—Ä–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ -->
    <div class="card">
      <button onclick="goBack()" class="btn_up">–ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</button>
      <h2>–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</h2>
      <label for="deviceSelect">–í—ã–±–µ—Ä–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ:</label>
      <select id="deviceSelect" onchange="updateDeviceInfo()">
        <option value="All">–í—Å–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</option>
        {% for device in devices %}
        <option value="{{ device }}">{{ device }}</option>
        {% endfor %}
      </select>
    </div>
    
    <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –≤—ã–±–æ—Ä–∞ —Ü–≤–µ—Ç–∞ -->
    <div class="card">
      <h2>–¶–≤–µ—Ç</h2>
      <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –º–µ–∂–¥—É –≤–∏–¥–∂–µ—Ç–∞–º–∏ –≤—ã–±–æ—Ä–∞ —Ü–≤–µ—Ç–∞ -->
      <div class="toggle-header" onclick="toggleElement('colorPickerContainer', this)">
        <span class="arrow">‚ñ∂</span> –°–∞–π—Ç–∞ ColorPicker
      </div>
      <div id="colorPickerContainer" class="toggle-content">
        <!-- –•–æ–ª—Å—Ç –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è —Ü–≤–µ—Ç–æ–≤–æ–≥–æ –∫–æ–ª–µ—Å–∞ -->
        <canvas id="colorWheel" width="400" height="400"></canvas><br>
        <a id="saturation_value">–ù–∞—Å—ã—â–µ–Ω–æ—Å—Ç—å (–Ø—Ä–∫–æ—Å—Ç—å): 100</a><br>
        <input type="range" id="saturation-slider" min="0" max="100" value="100" oninput="updateColorDisplay()">
        <div id="selectedColorDisplay"></div>
        <input type="text" id="colorInput" value="rgb(255, 255, 255)" oninput="manualColorChange()">
        <button onclick="applyColor()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ü–≤–µ—Ç</button>
      </div>
      
      <!-- –°–∏—Å—Ç–µ–º–Ω—ã–π ColorPicker -->
      <div class="toggle-header" onclick="toggleElement('systemColorPickerContainer', this)">
        <span class="arrow">‚ñ∂</span> –°–∏—Å—Ç–µ–º–Ω—ã–π ColorPicker
      </div>
      <div id="systemColorPickerContainer" class="toggle-content">
        <input type="color" id="colorPicker">
        <button onclick="setColor()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ü–≤–µ—Ç</button>
      </div>

      <!-- –ë–ª–æ–∫ —Å —Ç–µ–∫—É—â–∏–º —Ü–≤–µ—Ç–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∞–º–∏ -->
      <div style="margin-top: 10px;">
        <label>–¢–µ–∫—É—â–∏–π —Ü–≤–µ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:</label>
        <div id="currentColor"></div>
        <!-- –ü–∞–Ω–µ–ª—å –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –Ω–æ—á–Ω—ã—Ö —Ü–≤–µ—Ç–æ–≤ -->
        <div class="color-theme-btns">
          <br>
          <label>–ó–∞–≥–æ—Ç–æ–≤–∫–∏ –Ω–æ—á–Ω—ã–µ:</label>
          <div class="color-panel" style="background-color: #6a1300;" title="–ù–æ—á–Ω–æ–π –æ—Ä–∞–Ω–∂–µ–≤—ã–π" onclick="setColor_Faster('Night_Orange')"></div>
          <div class="color-panel" style="background-color: rgb(0, 8, 45);" title="–ù–æ—á–Ω–æ–π —Å–∏–Ω–∏–π" onclick="setColor_Faster('Night_Blue')"></div>
          <div class="color-panel" style="background-color: rgb(0, 45, 0);" title="–ù–æ—á–Ω–æ–π –∑–µ–ª–µ–Ω—ã–π" onclick="setColor_Faster('Night_Green')"></div>
          <div class="color-panel" style="background-color: rgb(0, 56, 51);" title="–ù–æ—á–Ω–æ–π –±–∏—Ä—é–∑–æ–≤—ã–π" onclick="setColor_Faster('Night_Turquoise')"></div>
        </div>
        <!-- –ü–∞–Ω–µ–ª—å –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –¥–Ω–µ–≤–Ω—ã—Ö —Ü–≤–µ—Ç–æ–≤ -->
        <div class="color-theme-btns">
          <br>
          <label>–ó–∞–≥–æ—Ç–æ–≤–∫–∏ –¥–Ω–µ–≤–Ω—ã–µ:</label>
          <div class="color-panel" style="background-color: rgb(255, 59, 0);" title="–î–Ω–µ–≤–Ω–æ–π –æ—Ä–∞–Ω–∂–µ–≤—ã–π" onclick="setColor_Faster('Day_Orange')"></div>
          <div class="color-panel" style="background-color: rgb(0, 0, 255);" title="–î–Ω–µ–≤–Ω–æ–π —Å–∏–Ω–∏–π" onclick="setColor_Faster('Day_Blue')"></div>
          <div class="color-panel" style="background-color: rgb(0, 255, 0);" title="–î–Ω–µ–≤–Ω–æ–π –∑–µ–ª–µ–Ω—ã–π" onclick="setColor_Faster('Day_Green')"></div>
          <div class="color-panel" style="background-color: rgb(0, 221, 201);" title="–î–Ω–µ–≤–Ω–æ–π –±–∏—Ä—é–∑–æ–≤—ã–π" onclick="setColor_Faster('Day_Turquoise')"></div>
        </div>
      </div>
    </div>
    
    <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –≤—ã–±–æ—Ä–∞ —Ä–µ–∂–∏–º–∞ –∏ —è—Ä–∫–æ—Å—Ç–∏ -->
    <div class="card">
      <h2>–†–µ–∂–∏–º –∏ –Ø—Ä–∫–æ—Å—Ç—å</h2>
      <label for="modeSelect">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º:</label>
      <select id="modeSelect">
        {% for mode in modes %}
        <option value="{{ mode }}">{{ mode }}</option>
        {% endfor %}
      </select>
      <button onclick="setMode()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ä–µ–∂–∏–º</button>
      <label for="brightnessSlider">–Ø—Ä–∫–æ—Å—Ç—å:</label>
      <input type="range" id="brightnessSlider" min="0" max="100" value="100" onchange="setBrightness()">
      <span id="brightnessValue">100%</span>
    </div>
    
    <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ —Å –æ–±—â–∏–º–∏ –∫–Ω–æ–ø–∫–∞–º–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
    <div class="card">
      <button onclick="turnOff()">–í—ã–∫–ª—é—á–∏—Ç—å –ø–æ–¥—Å–≤–µ—Ç–∫—É (–í—Å–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞)</button>
      <button onclick="logout_user()">–í—ã–π—Ç–∏</button>
      <br><br>
      <label>By FireTIA | HTML/CSS + Python + OpenRGB</label>
      <label>IoT-Light System v1.0.0 (Realese)</label>
    </div>
  </div>
  <br>

  <!-- –ù–∏–∂–Ω–∏–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫ —Å –≤–µ—Ä—Å–∏–µ–π –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ–º —Ç–µ–º—ã -->
  <div class="text_down">
    IoT-Light System v1.0.0 (Realese)<br>
    <a id="theme-name">Standart v1 | By FireTIA</a>
  </div>
  <!-- –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã -->
  <div class="theme-toggle" onclick="toggleStyle()">üîÑ</div>

  <!-- JavaScript: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
  <script src="{{ url_for('static', filename='vk_keyboard.js') }}"></script>
  <script>
    function csrfFetch(url, options = {}) {
        options.headers = options.headers || {};
        options.headers['X-CSRFToken'] = document.querySelector('meta[name="csrf-token"]').getAttribute('content');

        return fetch(url, options);
    }

    // –ü–æ–ª—É—á–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ü–≤–µ—Ç–æ–≤—ã–º –∫–æ–ª–µ—Å–æ–º –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ —Ü–≤–µ—Ç–∞
    const canvas = document.getElementById('colorWheel');
    const obj_saturation_value = document.getElementById('saturation_value');
    const ctx = canvas.getContext('2d');
    const slider = document.getElementById('saturation-slider');
    const colorDisplay = document.getElementById('selectedColorDisplay');
    const colorInput = document.getElementById('colorInput');
    let selectedColor = { r: 255, g: 255, b: 255 };
    let isDragging = false;

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    window.onload = function () {
      drawColorWheel(); // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ü–≤–µ—Ç–æ–≤–æ–≥–æ –∫–æ–ª–µ—Å–∞
      updateDeviceInfo(); // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
      loadTheme(); // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–π —Ç–µ–º—ã
    };

    // –í—ã–∑—ã–≤–∞–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
    window.addEventListener("load", resizeCanvas);
    window.addEventListener("resize", resizeCanvas);

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –º—ã—à–∏ –Ω–∞ —Ü–≤–µ—Ç–æ–≤–æ–º –∫–æ–ª–µ—Å–µ
    canvas.addEventListener('mousedown', () => isDragging = true);
    canvas.addEventListener('mouseup', () => isDragging = false);
    canvas.addEventListener('mousemove', (event) => {
      if (isDragging) {
        pickColor(event); // –í—ã–±–æ—Ä —Ü–≤–µ—Ç–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–∏ –º—ã—à–∏ –ø–æ —Ü–≤–µ—Ç–æ–≤–æ–º—É –∫–æ–ª–µ—Å—É
      }
    });

    function logout_user() {
      window.location.href = "/logout";
    }

    function goBack() {
      window.location.href = "/Menu.html"
    }


    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ü–≤–µ—Ç–∞ –Ω–∞ —Ü–≤–µ—Ç–æ–≤–æ–º –∫–æ–ª–µ—Å–µ
    function pickColor(event) {
      const rect = canvas.getBoundingClientRect();
      const x = event.clientX - rect.left;
      const y = event.clientY - rect.top;
      const pixel = ctx.getImageData(x, y, 1, 1).data;
      selectedColor = { r: pixel[0], g: pixel[1], b: pixel[2] };
      updateColorDisplay();
    }

    // –§—É–Ω–∫—Ü–∏—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ —Ü–≤–µ—Ç–æ–≤–æ–≥–æ –∫–æ–ª–µ—Å–∞
    function drawColorWheel() {
      const image = ctx.createImageData(canvas.width, canvas.height);
      const { width, height } = canvas;
      const radius = width / 2;
      
      for (let x = 0; x < width; x++) {
        for (let y = 0; y < height; y++) {
          const dx = x - radius;
          const dy = y - radius;
          const distance = Math.sqrt(dx * dx + dy * dy);
          if (distance > radius) continue;
          
          const angle = Math.atan2(dy, dx) * (180 / Math.PI) + 180;
          const hue = angle;
          const sat = distance / radius * 100;
          
          const { r, g, b } = hslToRgb(hue / 360, sat / 100, 0.5);
          const index = (y * width + x) * 4;
          image.data[index] = r;
          image.data[index + 1] = g;
          image.data[index + 2] = b;
          image.data[index + 3] = 255;
        }
      }
      ctx.putImageData(image, 0, 0);
    }
    
    // –§—É–Ω–∫—Ü–∏—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è HSL –≤ RGB
    function hslToRgb(h, s, l) {
      let r, g, b;
      if (s == 0) {
        r = g = b = l;
      } else {
        const hue2rgb = (p, q, t) => {
          if (t < 0) t += 1;
          if (t > 1) t -= 1;
          if (t < 1/6) return p + (q - p) * 6 * t;
          if (t < 1/2) return q;
          if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
          return p;
        };
        
        const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
        const p = 2 * l - q;
        r = hue2rgb(p, q, h + 1/3);
        g = hue2rgb(p, q, h);
        b = hue2rgb(p, q, h - 1/3);
      }
      return { r: Math.round(r * 255), g: Math.round(g * 255), b: Math.round(b * 255) };
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ —Ü–≤–µ—Ç–æ–≤–æ–º—É –∫–æ–ª–µ—Å—É –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ü–≤–µ—Ç–∞
    canvas.addEventListener('click', function(event) {
      const rect = canvas.getBoundingClientRect();
      const x = event.clientX - rect.left;
      const y = event.clientY - rect.top;
      const pixel = ctx.getImageData(x, y, 1, 1).data;
      selectedColor = { r: pixel[0], g: pixel[1], b: pixel[2] };

      

      const adjustedColor_math = {
        r: Math.round(selectedColor.r / 100),
        g: Math.round(selectedColor.g / 100),
        b: Math.round(selectedColor.b / 100)
      };
      colorInput.value = `rgb(${adjustedColor_math.r}, ${adjustedColor_math.g}, ${adjustedColor_math.b})`;
      slider.style.background = `linear-gradient(to right, rgb(${adjustedColor_math.r}, ${adjustedColor_math.g}, ${adjustedColor_math.b}), rgb(${selectedColor.r}, ${selectedColor.g}, ${selectedColor.b}))`;

      updateColorDisplay();
    });

    function resizeCanvas() {
      const canvas = document.getElementById("colorWheel");
        
      if (window.innerWidth <= 768) { // –ï—Å–ª–∏ —à–∏—Ä–∏–Ω–∞ —ç–∫—Ä–∞–Ω–∞ <= 768px (–º–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ)
        canvas.width = 300;
        canvas.height = 300;
      } else { // –ü–ö
        canvas.width = 400;
        canvas.height = 400;
      }

        drawColorWheel(); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Ü–≤–µ—Ç–æ–≤–æ–µ –∫–æ–ª–µ—Å–æ
    }
    
    // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞
    function updateColorDisplay() {
      const saturation = slider.value / 100;
      const adjustedColor = {
        r: Math.round(selectedColor.r * saturation),
        g: Math.round(selectedColor.g * saturation),
        b: Math.round(selectedColor.b * saturation)
      };
      
      const adjustedColor_math = {
        r: Math.round(selectedColor.r / 100),
        g: Math.round(selectedColor.g / 100),
        b: Math.round(selectedColor.b / 100)
      };
      
      colorDisplay.style.backgroundColor = `rgb(${adjustedColor.r}, ${adjustedColor.g}, ${adjustedColor.b})`;
      colorInput.value = `rgb(${adjustedColor.r}, ${adjustedColor.g}, ${adjustedColor.b})`;

      slider.style.background = `linear-gradient(to right, rgb(${adjustedColor_math.r}, ${adjustedColor_math.g}, ${adjustedColor_math.b}), rgb(${selectedColor.r}, ${selectedColor.g}, ${selectedColor.b}))`;
      
      obj_saturation_value.textContent = `–ù–∞—Å—ã—â–µ–Ω–æ—Å—Ç—å (–Ø—Ä–∫–æ—Å—Ç—å): ${slider.value}`
    }

    // –§—É–Ω–∫—Ü–∏—è —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞ —Ü–≤–µ—Ç–∞ —á–µ—Ä–µ–∑ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ
    function manualColorChange() {
      const rgbMatch = colorInput.value.match(/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/);
      if (rgbMatch) {
        selectedColor = {
          r: Math.min(255, Math.max(0, parseInt(rgbMatch[1]))),
          g: Math.min(255, Math.max(0, parseInt(rgbMatch[2]))),
          b: Math.min(255, Math.max(0, parseInt(rgbMatch[3])))
        };
        updateColorDisplay();
      }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞ (–æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å–µ—Ä–≤–µ—Ä)
    function applyColor() {
      const saturation = slider.value / 100;
      const adjustedColor = {
        r: Math.round(selectedColor.r * saturation),
        g: Math.round(selectedColor.g * saturation),
        b: Math.round(selectedColor.b * saturation)
      };
      let device = document.getElementById("deviceSelect").value;
      
      csrfFetch('/set_color', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
          r: adjustedColor.r, 
          g: adjustedColor.g, 
          b: adjustedColor.b, 
          device 
        })
      }).then(response => response.json()).then(data => {
        console.log('–¶–≤–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω:', data);
        
        let rgb = `rgb(${adjustedColor.r}, ${adjustedColor.g}, ${adjustedColor.b})`;
        let currentColorDiv_currentColor = document.getElementById("currentColor");
        let currentColorDiv_selectedColorDisplay = document.getElementById("selectedColorDisplay"); 
        currentColorDiv_currentColor.style.backgroundColor = rgb;
        currentColorDiv_selectedColorDisplay.style.backgroundColor = rgb;


        // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Ç–µ–Ω—å –¥–ª—è –±–ª–æ–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Ü–≤–µ—Ç–∞
        currentColorDiv_currentColor.style.boxShadow = `0px 4px 10px rgba(${adjustedColor.r}, ${adjustedColor.g}, ${adjustedColor.b}, 0.7)`;
        currentColorDiv_selectedColorDisplay.style.boxShadow = `0px 4px 10px rgba(${adjustedColor.r}, ${adjustedColor.g}, ${adjustedColor.b}, 0.7)`;

        // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Ç–µ–Ω—å –¥–ª—è –≤—Å–µ—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
        document.querySelectorAll('.card').forEach(card => {
          card.style.boxShadow = `0px 4px 10px rgba(${adjustedColor.r}, ${adjustedColor.g}, ${adjustedColor.b}, 0.7)`;
        });
        
      });
      
    }
    
    // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—ã–±–æ—Ä–∞ –≤ localStorage
    function toggleStyle() {
        let theme = document.getElementById("theme-style");
        let themeToggle = document.querySelector(".theme-toggle");
        let themeName = document.getElementById("theme-name");

        if (theme.getAttribute("href").includes("Index_Standart.css")) {
            themeName.textContent = "CrystalTheme v1 | By FireTIA";
            theme.setAttribute("href", "{{ url_for('static', filename='Index_Crystal.css') }}");
            localStorage.setItem("theme-page-index", "Index_Crystal.css");
        } else {
            themeName.textContent = "Standart v1 | By FireTIA";
            theme.setAttribute("href", "{{ url_for('static', filename='Index_Standart.css') }}");
            localStorage.setItem("theme-page-index", "Index_Standart.css");
        }
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–π —Ç–µ–º—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    function loadTheme() {
      let savedTheme = localStorage.getItem("theme-page-index");
      if (savedTheme) {
        document.getElementById("theme-style").setAttribute("href", `/static/${savedTheme}`);
      }
    }

    // –§—É–Ω–∫—Ü–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ü–≤–µ—Ç–∞ —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º–Ω—ã–π color picker
    function setColor() {
      let color = document.getElementById("colorPicker").value;
      let r = parseInt(color.substr(1, 2), 16);
      let g = parseInt(color.substr(3, 2), 16);
      let b = parseInt(color.substr(5, 2), 16);
      let device = document.getElementById("deviceSelect").value;

      csrfFetch('/set_color', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ r, g, b, device })
      }).then(response => response.json()).then(data => {
        console.log(data);
        updateDeviceInfo();
      });
    }

    // –§—É–Ω–∫—Ü–∏—è –±—ã—Å—Ç—Ä–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞
    function setColor_Faster(theme_color) {
        let device = document.getElementById("deviceSelect").value;

        // –û–±—ä—è–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–ª—è —Ü–≤–µ—Ç–∞
        let r, g, b;

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–Ω–∞—á–µ–Ω–∏–π —Ü–≤–µ—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ç–µ–º—ã
        if (theme_color === "Night_Orange") {
            r = 45;
            g = 8;
            b = 0;
        } else if (theme_color === 'Night_Blue') {
            r = 0;
            g = 8;
            b = 45;
        } else if (theme_color === 'Night_Green') {
            r = 0;
            g = 45;
            b = 0;
        } else if (theme_color === 'Night_Turquoise') {
            r = 0;
            g = 56;
            b = 51;
        } else if (theme_color === 'Day_Orange') {
            r = 255;
            g = 59;
            b = 0;
        } else if (theme_color === 'Day_Blue') {
            r = 0;
            g = 8;
            b = 255;
        } else if (theme_color === 'Day_Green') {
            r = 0;
            g = 255;
            b = 0;
        } else if (theme_color === 'Day_Turquoise') {
            r = 0;
            g = 221;
            b = 201;
        } else {
            // –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –µ—Å–ª–∏ —Ç–µ–º–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞
            r = 12;
            g = 12;
            b = 12;
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        csrfFetch('/set_color', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ r, g, b, device })
        })
        .then(response => response.json())
        .then(data => {
            console.log(data);
            updateDeviceInfo();
        })
        .catch(error => {
            console.error('–û—à–∏–±–∫–∞:', error);
        });
    }

    // –§—É–Ω–∫—Ü–∏—è –≤—ã–∫–ª—é—á–µ–Ω–∏—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
    function turnOff() {
      csrfFetch('/turn_off', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' }
      }).then(response => response.json()).then(data => {
        console.log(data);
        updateDeviceInfo();
      });
    }

    // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
    function RedirectDocumentation() {
      window.location.href = '/Open_Documentation';
    }
    
    function RedirectPcControl() {
      window.location.href = '/pc_control';
    }

    // –§—É–Ω–∫—Ü–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ –ø–æ–¥—Å–≤–µ—Ç–∫–∏
    function setMode() {
      let mode = document.getElementById("modeSelect").value;
      let device = document.getElementById("deviceSelect").value;

      csrfFetch('/set_mode', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ mode, device })
      }).then(response => response.json()).then(data => {
        console.log(data);
      });
    }

    // –§—É–Ω–∫—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —è—Ä–∫–æ—Å—Ç–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
    function setBrightness() {
      let brightness = document.getElementById("brightnessSlider").value;
      document.getElementById("brightnessValue").innerText = brightness + "%";
      let device = document.getElementById("deviceSelect").value;

      csrfFetch('/set_brightness', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ brightness, device })
      }).then(response => response.json()).then(data => {
        console.log(data);
      });
    }

    // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ, –≤–∫–ª—é—á–∞—è —Ç–µ–∫—É—â–∏–π —Ü–≤–µ—Ç –∏ —Ä–µ–∂–∏–º—ã
    function updateDeviceInfo() {
      let device = document.getElementById("deviceSelect").value;
      csrfFetch(`/get_device_info?device=${device}`)
        .then(response => response.json())
        .then(data => {
          if (data.length > 0) {
            let color = data[0].color;
            let rgb = `rgb(${color.r}, ${color.g}, ${color.b})`;
            let currentColorDiv_currentColor = document.getElementById("currentColor");
            let currentColorDiv_selectedColorDisplay = document.getElementById("selectedColorDisplay"); 
            currentColorDiv_currentColor.style.backgroundColor = rgb;
            currentColorDiv_selectedColorDisplay.style.backgroundColor = rgb;
            colorInput.value = `rgb(${color.r}, ${color.g}, ${color.b})`;
            selectedColor = { r: color.r, g: color.g, b: color.b };

            const adjustedColor_math = {
              r: Math.round(selectedColor.r / 100),
              g: Math.round(selectedColor.g / 100),
              b: Math.round(selectedColor.b / 100)
            };
            slider.style.background = `linear-gradient(to right, rgb(${adjustedColor_math.r}, ${adjustedColor_math.g}, ${adjustedColor_math.b}), rgb(${selectedColor.r}, ${selectedColor.g}, ${selectedColor.b}))`;

            // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Ç–µ–Ω—å –¥–ª—è –±–ª–æ–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Ü–≤–µ—Ç–∞
            currentColorDiv_currentColor.style.boxShadow = `0px 4px 10px rgba(${color.r}, ${color.g}, ${color.b}, 0.7)`;
            currentColorDiv_selectedColorDisplay.style.boxShadow = `0px 4px 10px rgba(${color.r}, ${color.g}, ${color.b}, 0.7)`;

            // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Ç–µ–Ω—å –¥–ª—è –≤—Å–µ—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
            document.querySelectorAll('.card').forEach(card => {
              card.style.boxShadow = `0px 4px 10px rgba(${color.r}, ${color.g}, ${color.b}, 0.7)`;
            });
            
            document.querySelectorAll('.btn_up').forEach(btn_up => {
              btn_up.style.boxShadow = `0px 2px 10px rgba(${color.r}, ${color.g}, ${color.b}, 0.3)`;
            });
          }
        });

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
      let modesSelect = document.getElementById("modeSelect");
      modesSelect.innerHTML = ''; // –û—á–∏—Å—Ç–∫–∞ —Ç–µ–∫—É—â–∏—Ö –æ–ø—Ü–∏–π

      csrfFetch(`/get_device_modes?device=${device}`)
        .then(response => response.json())
        .then(modes => {
          modes.forEach(mode => {
            let option = document.createElement("option");
            option.value = mode;
            option.innerText = mode;
            modesSelect.appendChild(option);
          });
        });
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è –∏ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (–∞–Ω–∏–º–∞—Ü–∏—è)
    function toggleElement(id, header) {
      let element = document.getElementById(id);
      if (element.style.maxHeight === "0px" || !element.style.maxHeight) {
          element.style.maxHeight = element.scrollHeight + "px";
          header.querySelector(".arrow").style.transform = "rotate(90deg)";
      } else {
          element.style.maxHeight = "0px";
          header.querySelector(".arrow").style.transform = "rotate(0deg)";
      }
    }
  </script>
</body>
</html>
